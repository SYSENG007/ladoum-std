# Module Reproduction - RÃ©sumÃ© Complet

**Application:** Ladoum STD  
**Version:** 1.0  
**Date:** 1er janvier 2026

---

## ğŸ“‹ Vue d'Ensemble

Le module **Reproduction** est un systÃ¨me complet de gestion de la reproduction pour l'Ã©levage de moutons Ladoum. Il combine la gestion opÃ©rationnelle (gestations, naissances) avec des outils avancÃ©s d'aide Ã  la dÃ©cision (simulations gÃ©nÃ©tiques et morphomÃ©triques).

---

## ğŸ¯ FonctionnalitÃ©s Principales

### **1. Gestion des Gestations** ğŸ¤°

**Onglet:** Gestations  
**IcÃ´ne:** CalendarClock

#### FonctionnalitÃ©s:
- âœ… **Suivi en temps rÃ©el** des gestations en cours
- âœ… **Calcul automatique** de la pÃ©riode de gestation (145 jours Â± 5)
- âœ… **DÃ©tection des retards** (jusqu'Ã  15 jours aprÃ¨s terme)
- âœ… **Affichage du pÃ¨re** si renseignÃ©
- âœ… **Badges colorÃ©s** selon l'urgence:
  - ğŸ”´ Rouge: Retard de X jours
  - ğŸŸ  Amber: < 30 jours restants
  - ğŸ”µ Bleu: > 30 jours restants

#### Logique:
```typescript
// Filtre intelligent:
- Cherche dernier accouplement/Ã©chographie
- VÃ©rifie qu'il n'y a pas de naissance aprÃ¨s
- Ignore si Ã©chographie nÃ©gative
- Calcule jours restants: 145 - jours depuis accouplement
- Masque si > 15 jours de retard
```

#### DonnÃ©es AffichÃ©es:
- Photo, nom et identifiant de la femelle
- Nombre de jours depuis l'accouplement
- Nom du pÃ¨re (si renseignÃ©)
- Date de mise bas prÃ©vue
- Jours restants / retard

---

### **2. Naissances RÃ©centes** ğŸ‘¶

**Onglet:** Naissances  
**IcÃ´ne:** Baby

#### FonctionnalitÃ©s:
- âœ… **Liste des agneaux nÃ©s** dans les 90 derniers jours
- âœ… **Tri chronologique** (plus rÃ©cent en premier)
- âœ… **Lien avec la mÃ¨re** si renseignÃ©e
- âœ… **Calcul de l'Ã¢ge** en jours

#### DonnÃ©es AffichÃ©es:
- Photo, nom et identifiant de l'agneau
- Genre (MÃ¢le/Femelle)
- Nom de la mÃ¨re
- Date de naissance
- Ã‚ge en jours

---

### **3. Simulation d'Accouplement** ğŸ§¬

**Onglet:** Simulation  
**IcÃ´ne:** TrendingUp  
**Composant:** `BreedingCalculator.tsx`

#### FonctionnalitÃ©s:

##### **A. Analyse GÃ©nÃ©tique**
- âœ… **Calcul du coefficient de consanguinitÃ© (COI)** via mÃ©thode de Wright
- âœ… **DÃ©tection des relations directes:**
  - Parent Ã— Enfant â†’ COI = 25%
  - Grand-parent Ã— Petit-enfant â†’ COI = 12.5%
  - FrÃ¨re Ã— SÅ“ur â†’ COI = 25%
  - Demi-frÃ¨res â†’ COI = 12.5%
  - Cousins â†’ COI = 3-6%
- âœ… **Classification du risque:**
  - Low (Faible): COI < 6.25%
  - Medium (Moyen): 6.25% â‰¤ COI < 12.5%
  - High (Ã‰levÃ©): COI â‰¥ 12.5%

##### **B. PrÃ©dictions MorphomÃ©triques**
- âœ… **PrÃ©diction des mesures** de la descendance:
  - **HG** (Hauteur au Garrot)
  - **LCS** (Longueur Corps Scapulo-ischiale)
  - **TP** (Tour de Poitrine)
- âœ… **Comparaison avec la moyenne** du troupeau (%)
- âœ… **Indicateurs visuels** (flÃ¨ches â†‘/â†“ vertes/rouges)

##### **C. Score Global (0-100)**
**Formule:**
```typescript
Score = (Score MorphomÃ©trique Ã— 60%) + ((100 - PÃ©nalitÃ© ConsanguinitÃ©) Ã— 40%)

OÃ¹:
- Score MorphomÃ©trique = Potentiel d'amÃ©lioration des mesures
- PÃ©nalitÃ© ConsanguinitÃ© = COI Ã— 50
```

**Recommandations:**
- **Excellent** (â‰¥85 + Low risk): Badge vert âœ…
- **Bon** (â‰¥70 + pas High): Badge bleu â„¹ï¸
- **Prudence** (â‰¥50 ou Medium): Badge amber âš ï¸
- **DÃ©conseillÃ©** (<50 ou High): Badge rouge ğŸš«

##### **D. Informations ComplÃ©mentaires**
- âœ… **Date de mise bas prÃ©vue** (aujourd'hui + 145 jours)
- âœ… **DÃ©tection des mesures manquantes** avec liens vers les fiches
- âœ… **Messages d'avertissement** si pedigrees incomplets (<30%)
- âœ… **Alertes** pour consanguinitÃ© Ã©levÃ©e

#### Interface:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SÃ©lection PÃ¨re (dropdown)           â”‚
â”‚ SÃ©lection MÃ¨re (dropdown)           â”‚
â”‚ [Lancer la simulation]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Score Global: 85/100 [Excellent]    â”‚
â”‚ â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘ 85%           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ConsanguinitÃ©: 3.1% [Faible]       â”‚
â”‚ Mise bas prÃ©vue: 15/06/2026        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HG: 78cm (+5%)                      â”‚
â”‚ LCS: 92cm (+3%)                     â”‚
â”‚ TP: 105cm (+7%)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **4. Simulation Matricielle** ğŸ“Š

**Onglet:** Matrice  
**IcÃ´ne:** Grid3X3  
**Composant:** `MatrixBreedingSimulator.tsx`

#### FonctionnalitÃ©s:

##### **A. Matrice de CompatibilitÃ©**
- âœ… **Calcul automatique** de TOUS les croisements possibles
- âœ… **Table interactive** MÃ¢les Ã— Femelles
- âœ… **Scores colorÃ©s** pour chaque combinaison:
  - ğŸŸ¢ Vert foncÃ©: Excellent (â‰¥85)
  - ğŸŸ¢ Vert clair: Bon (â‰¥70)
  - ğŸŸ  Amber: Prudence (â‰¥50)
  - ğŸ”´ Rouge: DÃ©conseillÃ© (<50)

##### **B. Top 10 Combinaisons**
- âœ… **Classement** des meilleures combinaisons
- âœ… **Tri configurable:**
  - Score global
  - ConsanguinitÃ© (croissant)
  - HG prÃ©dit
  - LCS prÃ©dit
  - TP prÃ©dit
- âœ… **Filtre optionnel:** Afficher uniquement faible risque

##### **C. DÃ©tails de Combinaison**
Cliquer sur une cellule/combinaison affiche:
- Photos pÃ¨re et mÃ¨re
- Score global et recommandation
- COI et niveau de risque
- PrÃ©dictions HG, LCS, TP
- Message d'avertissement si High risk

##### **D. Avertissements**
- âœ… **Pedigrees incomplets** (<30%): Badge amber explicatif
- âœ… **Guide utilisateur** pour remplir les pedigrees

#### Interface:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tri: [Score global â–¼] [âœ“ Faible risque]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        â”‚ Femelle1 â”‚ Femelle2 â”‚ Femelle3 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MÃ¢le1  â”‚   [95]   â”‚   [78]   â”‚   [82]   â”‚
â”‚ MÃ¢le2  â”‚   [88]   â”‚   [92]   â”‚   [65]   â”‚
â”‚ MÃ¢le3  â”‚   [71]   â”‚   [85]   â”‚   [90]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Top 10:
1. Alpha Ã— Beta      Score: 95  COI: 0.0%
2. Charlie Ã— Diana   Score: 92  COI: 3.1%
3. Echo Ã— Foxtrot    Score: 90  COI: 0.0%
...
```

---

### **5. Calendrier des Chaleurs** ğŸ“…

**Onglet:** Calendrier  
**IcÃ´ne:** Calendar  
**Composant:** `HeatCalendar.tsx` + `HeatCyclePredictor.tsx`

#### FonctionnalitÃ©s:

##### **A. PrÃ©diction Intelligente**
- âœ… **Analyse de l'historique** de reproduction de chaque femelle
- âœ… **Calcul du cycle moyen** (dÃ©faut: 17 jours)
- âœ… **Ajustement personnalisÃ©** par brebis
- âœ… **FenÃªtre de surveillance** (Â±2 jours)
- âœ… **PrÃ©diction jusqu'Ã  3 mois** Ã  l'avance

**Algorithme:**
```typescript
1. RÃ©cupÃ©rer tous les Ã©vÃ©nements de chaleur passÃ©s
2. Calculer intervalle moyen entre chaleurs
3. Extrapoler les prochaines chaleurs
4. Ajouter fenÃªtre Â±2 jours
5. Exclure si gestation en cours
```

##### **B. Calendrier Visuel**
- âœ… **Vue mensuelle** avec navigation
- âœ… **Points colorÃ©s** sur les jours avec chaleurs prÃ©vues
- âœ… **Tooltip** au survol avec dÃ©tails
- âœ… **Clic** pour voir toutes les femelles du jour

##### **C. Liste des PrÃ©dictions**
- âœ… **Prochaines chaleurs** (30 jours)
- âœ… **Tri chronologique**
- âœ… **Photo et infos** de chaque femelle
- âœ… **Date et fenÃªtre** de surveillance
- âœ… **Badge de confiance:**
  - Haute: BasÃ© sur â‰¥3 enregistrements
  - Moyenne: 2 enregistrements
  - Faible: 1 ou aucun enregistrement

#### Interface:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    DÃ©cembre 2025                    â”‚
â”‚ L  M  M  J  V  S  D                 â”‚
â”‚ 1  2  3  4  5  6  7                 â”‚
â”‚ 8  9 10 â—11 12 13 14                â”‚
â”‚15 â—16 17 18 â—19 20 21               â”‚
â”‚22 23 â—24 25 26 27 28                â”‚
â”‚29 30 31                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Prochaines chaleurs:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â— Beta - 11 dÃ©c (9-13 dÃ©c)          â”‚
â”‚   Confiance: Haute                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â— Diana - 16 dÃ©c (14-18 dÃ©c)        â”‚
â”‚   Confiance: Moyenne                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **6. Enregistrement d'Ã‰vÃ©nements** ğŸ“

**Bouton:** Enregistrer un Ã©vÃ©nement  
**Composant:** `ReproductionEventModal.tsx`

#### Types d'Ã‰vÃ©nements:

##### **A. Chaleur (Heat)**
- Date de l'observation
- SÃ©lection de la femelle
- Notes optionnelles
- â†’ UtilisÃ© pour prÃ©diction future

##### **B. Accouplement (Mating)**
- Date de l'accouplement
- Femelle (obligatoire)
- MÃ¢le (optionnel mais recommandÃ©)
- Type: Naturel / InsÃ©mination artificielle
- Notes
- â†’ DÃ©marre suivi de gestation

##### **C. Ã‰chographie (Ultrasound)**
- Date de l'examen
- Femelle
- RÃ©sultat: Positive / Negative
- Nombre de fÅ“tus (si positif)
- Notes
- â†’ Confirme ou annule la gestation

##### **D. Naissance (Birth)**
- Date de naissance
- Femelle (mÃ¨re)
- Nombre d'agneaux
- Poids Ã  la naissance
- Complications Ã©ventuelles
- Notes
- â†’ Termine la gestation
- â†’ CrÃ©e nouvelles fiches animaux

##### **E. Avortement (Abortion)**
- Date
- Femelle
- Cause (si connue)
- Notes
- â†’ Termine la gestation

#### Validation:
- âœ… VÃ©rification des champs requis
- âœ… CohÃ©rence des dates
- âœ… Enregistrement dans `reproductionRecords[]`

---

## ğŸ§® Algorithmes ImplÃ©mentÃ©s

### **1. Calcul de ConsanguinitÃ© (COI)**
**Fichier:** `/utils/genetics.ts`

**MÃ©thode:** Wright's Path Method

**Cas gÃ©rÃ©s:**
1. **Relations directes** (vÃ©rification prioritaire):
   ```typescript
   Parent Ã— Enfant â†’ return 0.25
   Grand-parent Ã— Petit-enfant â†’ return 0.125
   ```

2. **AncÃªtres communs** (calcul standard):
   ```typescript
   Pour chaque ancÃªtre commun:
     Trouver chemins PÃ¨re â†’ AncÃªtre
     Trouver chemins MÃ¨re â†’ AncÃªtre
     Pour chaque paire de chemins valides:
       COI += (0.5)^(longueur_chemin)
   ```

**Profondeur:** 5 gÃ©nÃ©rations max

**Fonctions auxiliaires:**
- `getParents()` - Parents directs
- `getGrandparents()` - 4 grands-parents
- `findCommonAncestors()` - Liste ancÃªtres partagÃ©s
- `findPathsToAncestor()` - Tous les chemins vers un ancÃªtre
- `getInbreedingRisk()` - Classification Low/Medium/High

---

### **2. PrÃ©dictions MorphomÃ©triques**
**Fichier:** `/utils/morphometrics.ts`

**MÃ©thode:** Moyenne pondÃ©rÃ©e hÃ©ritabilitÃ©

**Formule:**
```typescript
PrÃ©diction = (
    (Mesure_PÃ¨re Ã— HÃ©ritabilitÃ©) +
    (Mesure_MÃ¨re Ã— HÃ©ritabilitÃ©) +
    (Moyenne_Troupeau Ã— (1 - 2Ã—HÃ©ritabilitÃ©))
) / 2
```

**HÃ©ritabilitÃ©s (moutons):**
- HG (Hauteur): 0.40 (40%)
- LCS (Longueur): 0.35 (35%)
- TP (Poitrine): 0.30 (30%)

**Score de CompatibilitÃ©:**
```typescript
Score = (
    Potentiel_HG Ã— 40% +
    Potentiel_LCS Ã— 30% +
    Potentiel_TP Ã— 30%
) Ã— 100

OÃ¹ Potentiel = (PrÃ©diction - Moyenne) / Moyenne
```

**Gestion des donnÃ©es manquantes:**
- Si parent non mesurÃ© â†’ Utilise moyenne troupeau
- Si aucune donnÃ©e â†’ Retourne 0

---

### **3. PrÃ©diction des Chaleurs**
**Fichier:** `HeatCyclePredictor.tsx`

**Algorithme:**
```typescript
1. Filtrer femelles actives non gestantes
2. Pour chaque femelle:
   a. Extraire Ã©vÃ©nements de chaleur passÃ©s
   b. Calculer intervalles entre chaleurs
   c. Calculer moyenne des intervalles (dÃ©faut: 17j)
   d. DerniÃ¨re chaleur + cycle moyen = Prochaine
   e. GÃ©nÃ©rer 3-4 prÃ©dictions futures
   f. Ajouter fenÃªtre Â±2 jours
3. Trier par date chronologique
4. Calculer confiance basÃ©e sur nb d'enregistrements
```

**ParamÃ¨tres:**
- Cycle par dÃ©faut: 17 jours
- FenÃªtre surveillance: Â±2 jours
- Horizon prÃ©diction: 90 jours
- Confiance:
  - Haute: â‰¥3 chaleurs enregistrÃ©es
  - Moyenne: 2 chaleurs
  - Faible: â‰¤1 chaleur

---

## ğŸ“Š Statistiques AffichÃ©es

**En-tÃªte du module:**
- **Femelles:** Nombre total actives
- **MÃ¢les:** Nombre total actifs
- **Gestations:** Nombre en cours
- **Naissances (90j):** Agneaux nÃ©s rÃ©cemment

---

## ğŸ¨ Design & UX

### **Codes Couleurs:**
- ğŸŸ¢ **Vert:** Excellent, bon, faible risque
- ğŸ”µ **Bleu:** Info, normal
- ğŸŸ  **Amber:** Prudence, attention, moyen
- ğŸ”´ **Rouge:** DÃ©conseillÃ©, Ã©levÃ©, retard

### **Badges:**
- `success` (vert): Score excellent, risque faible
- `info` (bleu): Bonne qualitÃ©, normal
- `warning` (amber): Prudence, moyen
- `error` (rouge): DÃ©conseillÃ©, Ã©levÃ©

### **Interactions:**
- Cartes cliquables dans la matrice
- Tooltips informatifs
- Modales pour dÃ©tails
- Navigation par onglets
- Filtres et tris dynamiques

---

## ğŸ”— IntÃ©grations

### **DonnÃ©es UtilisÃ©es:**
1. **Animals** (`Animal[]`)
   - Informations de base
   - Pedigree (`sireId`, `damId`)
   - Mesures morphomÃ©triques
   - Historique reproduction

2. **Reproduction Records**
   ```typescript
   {
     type: 'Heat' | 'Mating' | 'Ultrasound' | 'Birth' | 'Abortion'
     date: string
     mateId?: string
     ultrasoundResult?: 'Positive' | 'Negative'
     numberOfOffspring?: number
     notes?: string
   }
   ```

### **Services:**
- `AnimalService` - CRUD animaux
- `useAnimals()` hook - Ã‰tat global

---

## âš ï¸ Limitations Connues

1. **Pedigrees incomplets:**
   - Message d'avertissement si <30%
   - COI = 0% si pas d'ancÃªtres
   - Solution: Remplir manuellement

2. **Mesures morphomÃ©triques:**
   - Message si parent non mesurÃ©
   - PrÃ©dictions moins prÃ©cises
   - Liens vers fiches pour ajout

3. **Profondeur gÃ©nÃ©alogique:**
   - LimitÃ© Ã  5 gÃ©nÃ©rations
   - Trade-off performance/prÃ©cision

4. **PrÃ©dictions chaleurs:**
   - NÃ©cessite historique
   - Confiance faible si <3 enregistrements
   - Cycle fixe (17j) par dÃ©faut

---

## ğŸš€ Points Forts

âœ… **Complet:** Gestion + Simulation + PrÃ©diction  
âœ… **Scientifique:** Algorithmes gÃ©nÃ©tiques reconnus  
âœ… **Intuitif:** Interface claire et guidÃ©e  
âœ… **Robuste:** Gestion des donnÃ©es manquantes  
âœ… **Ã‰ducatif:** Explications et recommandations  
âœ… **Temps rÃ©el:** Calculs instantanÃ©s  
âœ… **Visuel:** Codes couleurs, badges, graphiques  
âœ… **Actionnable:** Liens directs vers fiches  

---

## ğŸ“ˆ Cas d'Usage

### **Ã‰leveur DÃ©butant:**
1. Enregistre accouplements
2. Suit gestations avec alertes
3. Consulte prÃ©dictions chaleurs
4. ReÃ§oit guidage simple/interdit

### **Ã‰leveur AvancÃ©:**
1. Utilise simulation matricielle
2. Optimise gÃ©nÃ©tique (COI)
3. AmÃ©liore morphomÃ©trie (HG, LCS, TP)
4. Planifie sÃ©lection Ã  long terme

### **SÃ©lectionneur Professionnel:**
1. Analyse tous croisements possibles
2. Classe par critÃ¨re spÃ©cifique
3. Ã‰vite consanguinitÃ© tout en amÃ©liorant
4. Suit pedigrees complets

---

## ğŸ¯ RÃ©sumÃ© en 1 Phrase

**Le module Reproduction combine la gestion opÃ©rationnelle quotidienne (gestations, naissances, chaleurs) avec des outils avancÃ©s de simulation gÃ©nÃ©tique et morphomÃ©trique basÃ©s sur les donnÃ©es rÃ©elles du troupeau, permettant aux Ã©leveurs de Ladoum de gÃ©rer et d'optimiser leur reproduction en toute connaissance de cause.**

---

*DerniÃ¨re mise Ã  jour: 1er janvier 2026, 12:15*
