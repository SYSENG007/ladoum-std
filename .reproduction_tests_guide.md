# Tests du Module Reproduction V1.1

**Date:** 1er janvier 2026  
**Status:** âœ… Tests crÃ©Ã©s - PrÃªts Ã  exÃ©cuter

---

## ğŸ“ FICHIERS DE TESTS CRÃ‰Ã‰S

```
src/utils/__tests__/
â”œâ”€â”€ genetics.test.ts         (14 tests)
â”œâ”€â”€ morphometrics.test.ts    (11 tests)
â””â”€â”€ breedingRules.test.ts    (10 tests)

TOTAL: 35 tests
```

---

## ğŸ§ª COUVERTURE DES TESTS

### genetics.test.ts (14 tests)

**assessPedigreeDepth:**
- âœ“ Animal sans parents â†’ 0
- âœ“ Animal avec parents mais pas grands-parents â†’ 1
- âœ“ 2 gÃ©nÃ©rations complÃ¨tes â†’ 2
- âœ“ 3 gÃ©nÃ©rations complÃ¨tes â†’ 3

**calculateInbreedingCoefficient:**
- âœ“ **PRD Cas 1:** Pedigree vide â†’ null
- âœ“ **PRD Cas 2:** FrÃ¨re Ã— SÅ“ur â†’ 0.25
- âœ“ **PRD Cas 3:** Cousins germains â†’ 0.0625
- âœ“ **PRD Cas 4:** Non apparentÃ©s â†’ 0
- âœ“ Parent Ã— Enfant â†’ 0.25
- âœ“ Grand-parent Ã— Petit-enfant â†’ 0.125
- âœ“ Pedigree incomplet â†’ INCOMPLETE_GENERATIONS
- âœ“ Demi-frÃ¨res â†’ 0.125

### morphometrics.test.ts (11 tests)

**predictTrait:**
- âœ“ **PRD Cas A:** 2 parents mesurÃ©s â†’ confidence â‰¥ 0.75
- âœ“ **PRD Cas B:** 1 parent mesurÃ© â†’ confidence 0.45-0.6
- âœ“ **PRD Cas C:** Population seulement â†’ confidence < 0.4
- âœ“ **PRD Cas D:** Aucune donnÃ©e â†’ INSUFFICIENT_DATA
- âœ“ Intervalle plus large avec 1 vs 2 parents
- âœ“ HÃ©ritabilitÃ© affecte prÃ©diction

**calculateMorphometricScore:**
- âœ“ Score calculable avec 2 parents
- âœ“ Score null si donnÃ©es insuffisantes
- âœ“ Confidence = moyenne traits
- âœ“ Score > 50 si au-dessus moyenne
- âœ“ Score < 50 si en-dessous moyenne
- âœ“ DataBasis cohÃ©rent pour tous traits

### breedingRules.test.ts (10 tests)

**RÃ¨gles Expertes:**
- âœ“ **R4:** Aucune donnÃ©e â†’ NOT_COMPUTABLE
- âœ“ **R1:** Pedigree incomplet â†’ LOW_CONFIDENCE
- âœ“ **R2:** COI â‰¥ 12.5% â†’ NotRecommended
- âœ“ **R3:** Morpho < 50% â†’ LOW_CONFIDENCE
- âœ“ **R5:** Score Ã©levÃ© mais donnÃ©es partielles â†’ pas Excellent

**Integration:**
- âœ“ Cas idÃ©al complet â†’ RELIABLE + Excellent
- âœ“ expectedDueDate toujours calculÃ©
- âœ“ Warnings toujours tableau
- âœ“ COI Ã©levÃ© override score morpho
- âœ“ RÃ¨gles appliquÃ©es dans bon ordre

---

## ğŸš€ COMMENT EXÃ‰CUTER LES TESTS

### Option 1: Tout exÃ©cuter
```bash
npm test
```

### Option 2: Seulement genetics
```bash
npm test genetics.test.ts
```

### Option 3: Seulement morphometrics
```bash
npm test morphometrics.test.ts
```

### Option 4: Seulement breedingRules
```bash
npm test breedingRules.test.ts
```

### Option 5: Mode watch (redÃ©marre auto au changement)
```bash
npm test -- --watch
```

### Option 6: Avec coverage
```bash
npm test -- --coverage
```

---

## ğŸ“Š RÃ‰SULTATS ATTENDUS

### Si tous les tests passent:
```
PASS  src/utils/__tests__/genetics.test.ts
  âœ“ assessPedigreeDepth (14 tests, 14 passed)
  âœ“ calculateInbreedingCoefficient (10 tests, 10 passed)

PASS  src/utils/__tests__/morphometrics.test.ts
  âœ“ predictTrait (6 tests, 6 passed)
  âœ“ calculateMorphometricScore (5 tests, 5 passed)

PASS  src/utils/__tests__/breedingRules.test.ts
  âœ“ Expert Rules System (5 tests, 5 passed)
  âœ“ simulateBreeding Integration (5 tests, 5 passed)

Test Suites: 3 passed, 3 total
Tests:       35 passed, 35 total
Snapshots:   0 total
Time:        2.456s
```

---

## âš™ï¸ CONFIGURATION

### Si Jest n'est pas configurÃ©, ajouter dans package.json:

```json
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage"
  },
  "jest": {
    "preset": "ts-jest",
    "testEnvironment": "node",
    "roots": ["<rootDir>/src"],
    "testMatch": ["**/__tests__/**/*.test.ts"],
    "transform": {
      "^.+\\.tsx?$": "ts-jest"
    }
  }
}
```

### DÃ©pendances nÃ©cessaires:
```bash
npm install --save-dev jest ts-jest @types/jest
```

---

## ğŸ› DEBUGGING

### Si un test Ã©choue:

**1. Lire l'erreur:**
```
Expected: 0.25
Received: 0.0
```

**2. VÃ©rifier la logique:**
- Est-ce que `findCommonAncestors` fonctionne?
- Est-ce que les IDs correspondent?

**3. Ajouter des console.log:**
```typescript
test('Debug test', () => {
  const result = calculateInbreedingCoefficient(...);
  console.log('Result:', result);
  expect(result.coefficient).toBe(0.25);
});
```

**4. ExÃ©cuter en isolation:**
```bash
npm test -- genetics.test.ts -t "Cas 2"
```

---

## ğŸ“ˆ COUVERTURE VISÃ‰E

**Objectif:**
- âœ… Fonctions critiques: 100%
- âœ… Cas mÃ©tier PRD: 100%
- âœ… Edge cases: 80%+

**Fichiers couverts:**
- `utils/genetics.ts`: 90%+
- `utils/morphometrics.ts`: 85%+
- `utils/breedingRules.ts`: 95%+

---

## ğŸ¯ PROCHAINES Ã‰TAPES

### AprÃ¨s que les tests passent:

**1. CI/CD Integration**
```yaml
# .github/workflows/test.yml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: npm install
      - run: npm test
```

**2. Pre-commit Hook**
```bash
# .husky/pre-commit
#!/bin/sh
npm test
```

**3. Tests E2E (Future)**
- Tester UI components
- Simuler interactions utilisateur
- VÃ©rifier affichage rÃ©sultats

---

## ğŸ“ MAINTENANCE

### Ajouter un nouveau test:

**1. CrÃ©er le test:**
```typescript
test('Mon nouveau cas', () => {
  // Arrange
  const sire = createAnimal(...);
  const dam = createAnimal(...);
  
  // Act
  const result = simulateBreeding(sire, dam, herd);
  
  // Assert
  expect(result.globalScore.status).toBe('RELIABLE');
});
```

**2. L'exÃ©cuter:**
```bash
npm test
```

**3. L'ajouter au CI:**
- C'est automatique! Tous les test.ts sont dÃ©tectÃ©s

---

## ğŸ‰ VALIDATION FINALE

### Checklist avant Production:

- [ ] Tous les tests passent
- [ ] Coverage â‰¥ 85%
- [ ] Pas de console.log en production
- [ ] Tests dans CI/CD
- [ ] Documentation Ã  jour

---

*Les tests garantissent que le systÃ¨me expert fonctionne selon les spÃ©cifications du PRD V1.1.*
